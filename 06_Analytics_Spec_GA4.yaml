ga4_configuration:
  measurement_id: "G-XXXXXXXXXX"  # [要確定]
  gtm_container_id: "GTM-XXXXXXX"  # [要確定]
  
  enhanced_measurement:
    page_views: true
    scrolls: true
    outbound_clicks: true
    site_search: true
    video_engagement: true
    file_downloads: true

events:
  page_interaction:
    view_content:
      trigger: "ページスクロール25/50/75/100%"
      parameters:
        content_type: "section"
        content_id: "hero|plans|gallery|safety|pricing|faq"
        scroll_depth: 25|50|75|100
      example_payload:
        event: "view_content"
        content_type: "section"
        content_id: "pricing"
        scroll_depth: 50

    click_cta:
      trigger: "CTAボタンクリック"
      parameters:
        button_text: "ボタンのラベル"
        button_location: "header|hero|section|fixed_footer"
        button_type: "primary|secondary"
        destination: "form|calendar|modal"
      example_payload:
        event: "click_cta"
        button_text: "空き枠を見る"
        button_location: "hero"
        button_type: "primary"
        destination: "calendar"

    tab_switch:
      trigger: "年齢タブ切替"
      parameters:
        from_tab: "前のタブ値"
        to_tab: "新しいタブ値"
        tab_index: 0|1|2|3
      example_payload:
        event: "tab_switch"
        from_tab: "kindergarten"
        to_tab: "elementary_low"
        tab_index: 1

  form_tracking:
    form_start:
      trigger: "フォーム入力開始"
      parameters:
        form_type: "reservation|inquiry|newsletter"
        form_step: "plan|schedule|info|payment"
        entry_point: "開始した場所"
      example_payload:
        event: "form_start"
        form_type: "reservation"
        form_step: "plan"
        entry_point: "hero_cta"

    form_progress:
      trigger: "フォームステップ完了"
      parameters:
        form_type: "reservation|inquiry"
        completed_step: "完了したステップ"
        next_step: "次のステップ"
        time_spent: "秒数"
      example_payload:
        event: "form_progress"
        form_type: "reservation"
        completed_step: "schedule"
        next_step: "info"
        time_spent: 45

    form_submit:
      trigger: "フォーム送信成功"
      parameters:
        form_type: "reservation|inquiry"
        form_id: "フォームID"
        submission_value: "金額（予約の場合）"
      example_payload:
        event: "form_submit"
        form_type: "reservation"
        form_id: "form_001"
        submission_value: 0

    form_error:
      trigger: "フォームエラー発生"
      parameters:
        form_type: "reservation|inquiry"
        error_field: "エラーが発生したフィールド"
        error_message: "エラーメッセージ"
        form_step: "現在のステップ"
      example_payload:
        event: "form_error"
        form_type: "reservation"
        error_field: "email"
        error_message: "メールアドレスの形式が正しくありません"
        form_step: "info"

  ecommerce:
    view_item:
      trigger: "プラン詳細表示"
      parameters:
        currency: "JPY"
        value: "金額"
        items:
          - item_id: "プランID"
            item_name: "プラン名"
            item_category: "年齢区分"
            item_category2: "プランタイプ"
            price: "金額"
      example_payload:
        event: "view_item"
        currency: "JPY"
        value: 10000
        items:
          - item_id: "plan_exploration_k"
            item_name: "はじめての探究"
            item_category: "kindergarten"
            item_category2: "exploration"
            price: 10000

    add_to_cart:
      trigger: "予約カレンダーで日時選択"
      parameters:
        currency: "JPY"
        value: "金額"
        items:
          - item_id: "スロットID"
            item_name: "日時・プラン名"
            item_category: "年齢区分"
            item_variant: "日時"
            price: "金額"
            quantity: 1
      example_payload:
        event: "add_to_cart"
        currency: "JPY"
        value: 0
        items:
          - item_id: "slot_20251001_1600"
            item_name: "10/1 16:00 はじめての探究"
            item_category: "kindergarten"
            item_variant: "2025-10-01T16:00"
            price: 0
            quantity: 1

    begin_checkout:
      trigger: "決済画面遷移"
      parameters:
        currency: "JPY"
        value: "合計金額"
        coupon: "クーポンコード"
        items: "選択したアイテム配列"
      example_payload:
        event: "begin_checkout"
        currency: "JPY"
        value: 0
        items:
          - item_id: "slot_20251001_1600"
            item_name: "10/1 16:00 体験会"
            price: 0
            quantity: 1

    purchase:
      trigger: "決済完了"
      parameters:
        transaction_id: "取引ID"
        currency: "JPY"
        value: "合計金額"
        tax: "税額"
        payment_type: "card|apple_pay|google_pay"
        items: "購入アイテム配列"
      example_payload:
        event: "purchase"
        transaction_id: "TXN_20251001_001"
        currency: "JPY"
        value: 10000
        tax: 1000
        payment_type: "card"
        items:
          - item_id: "course_exploration_202511"
            item_name: "探究コース11月"
            price: 10000
            quantity: 1

  user_engagement:
    video_play:
      trigger: "動画再生開始"
      parameters:
        video_title: "動画タイトル"
        video_provider: "youtube|vimeo|custom"
        video_url: "動画URL"
      example_payload:
        event: "video_play"
        video_title: "授業風景紹介"
        video_provider: "youtube"
        video_url: "https://youtube.com/watch?v=xxx"

    gallery_interaction:
      trigger: "ギャラリー操作"
      parameters:
        action: "swipe|click|zoom"
        image_index: "画像インデックス"
        image_alt: "画像説明"
      example_payload:
        event: "gallery_interaction"
        action: "swipe"
        image_index: 3
        image_alt: "プログラミング作品"

    faq_interaction:
      trigger: "FAQ開閉"
      parameters:
        action: "open|close"
        question_id: "質問ID"
        question_text: "質問文"
      example_payload:
        event: "faq_interaction"
        action: "open"
        question_id: "faq_001"
        question_text: "プログラミング経験がなくても大丈夫ですか？"

    social_share:
      trigger: "SNSシェアボタンクリック"
      parameters:
        method: "platform名"
        content_type: "page|event|course"
        item_id: "共有アイテムID"
      example_payload:
        event: "share"
        method: "twitter"
        content_type: "event"
        item_id: "trial_202510"

custom_dimensions:
  user_properties:
    user_type:
      description: "ユーザータイプ"
      values: ["new", "returning", "registered"]
    
    preferred_age_group:
      description: "関心のある年齢区分"
      values: ["kindergarten", "elementary_low", "elementary_mid", "elementary_high"]
    
    registration_status:
      description: "登録状態"
      values: ["visitor", "trial_registered", "course_enrolled"]

  event_parameters:
    session_quality:
      description: "セッション品質スコア"
      calculation: "engagement_time / session_duration * 100"
    
    form_completion_rate:
      description: "フォーム完了率"
      calculation: "form_submit / form_start * 100"

audiences:
  high_intent_users:
    definition: "価格セクション到達 AND 滞在時間 > 3分"
    
  cart_abandoners:
    definition: "begin_checkout発火 AND NOT purchase（24時間以内）"
    
  engaged_parents:
    definition: "FAQ開封3回以上 OR ギャラリー閲覧"
    
  mobile_users:
    definition: "device_category = mobile"

conversions:
  primary:
    trial_registration:
      event: "purchase"
      condition: "value = 0"
      counting_method: "once_per_session"
    
    course_purchase:
      event: "purchase"
      condition: "value > 0"
      counting_method: "once_per_user"
  
  secondary:
    form_start:
      event: "form_start"
      counting_method: "once_per_session"
    
    high_engagement:
      event: "user_engagement"
      condition: "engagement_time > 180"
      counting_method: "once_per_session"

debug_process:
  gtm_preview:
    steps:
      - "GTMコンテナをプレビューモード起動"
      - "サイトアクセス・操作実行"
      - "Tag Assistantで発火確認"
      - "Variables値チェック"
  
  ga4_debugview:
    steps:
      - "GA4管理画面 > DebugView開く"
      - "デバッグパラメータ付きアクセス（?_debug=1）"
      - "リアルタイムイベント確認"
      - "パラメータ値検証"
  
  validation_checklist:
    - "全CTAクリックイベント発火"
    - "フォーム各ステップ計測"
    - "Enhanced Ecommerce正常動作"
    - "カスタムディメンション送信"
    - "コンバージョン計測"